<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽµ Music Generation Studio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-dark bg-gradient sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-music"></i> Music Generation Studio
            </a>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-light btn-sm" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container-fluid py-5">
        <div class="row g-4">
            <!-- Left Panel - Controls -->
            <div class="col-lg-4">
                <div class="card shadow-lg border-0 sticky-lg-top" style="top: 80px;">
                    <div class="card-header bg-gradient text-white">
                        <h5 class="mb-0"><i class="fas fa-sliders-h"></i> Generation Controls</h5>
                    </div>
                    <div class="card-body">
                        <form id="generationForm">
                            <!-- Seed Input -->
                            <div class="mb-4">
                                <label for="seedInput" class="form-label fw-bold">
                                    <i class="fas fa-leaf"></i> Seed Text
                                    <span class="badge bg-info ms-2" data-bs-toggle="tooltip" title="Starting text for generation">?</span>
                                </label>
                                <textarea class="form-control form-control-lg" id="seedInput" rows="3" placeholder="Leave empty for random generation" style="resize: none;"></textarea>
                                <small class="text-muted d-block mt-2"><i class="fas fa-info-circle"></i> Max 50 characters</small>
                            </div>

                            <!-- Temperature Slider -->
                            <div class="mb-4">
                                <label for="temperatureSlider" class="form-label fw-bold">
                                    <i class="fas fa-fire"></i> Temperature: <span id="temperatureValue" class="badge bg-primary">1.0</span>
                                </label>
                                <input type="range" class="form-range form-range-lg" id="temperatureSlider" min="0.1" max="2.0" step="0.1" value="1.0">
                                <div class="d-flex justify-content-between small text-muted mt-2">
                                    <span><i class="fas fa-snowflake"></i> Deterministic</span>
                                    <span>Creative <i class="fas fa-fire"></i></span>
                                </div>
                            </div>

                            <!-- Sequence Length Slider -->
                            <div class="mb-4">
                                <label for="lengthSlider" class="form-label fw-bold">
                                    <i class="fas fa-ruler"></i> Length: <span id="lengthValue" class="badge bg-success">250</span>
                                </label>
                                <input type="range" class="form-range form-range-lg" id="lengthSlider" min="50" max="500" step="10" value="250">
                                <small class="text-muted d-block mt-2"><i class="fas fa-info-circle"></i> 50-500 characters</small>
                            </div>

                            <!-- Generate Button -->
                            <button type="submit" class="btn btn-primary btn-lg w-100 fw-bold" id="generateBtn">
                                <i class="fas fa-magic"></i> Generate Music
                                <span id="generateSpinner" class="spinner-border spinner-border-sm ms-2" style="display: none;"></span>
                            </button>
                        </form>

                        <!-- Error Alert -->
                        <div id="errorAlert" class="alert alert-danger mt-3" style="display: none;">
                            <i class="fas fa-exclamation-circle"></i> <span id="errorText"></span>
                        </div>

                        <!-- Stats -->
                        <div class="mt-4 pt-3 border-top">
                            <small class="text-muted d-block mb-2"><i class="fas fa-chart-bar"></i> Generation Stats</small>
                            <div class="d-flex justify-content-between small">
                                <span>Total Generated: <strong id="totalGenerated">0</strong></span>
                                <span>Favorites: <strong id="totalFavorites">0</strong></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Display & Playback -->
            <div class="col-lg-8">
                <!-- Model Story Card -->
                <div class="card shadow-lg border-0 mb-4">
                    <div class="card-header bg-gradient text-white">
                        <h5 class="mb-0"><i class="fas fa-brain"></i> About This Model</h5>
                    </div>
                    <div class="card-body">
                        <p class="mb-2">
                            <strong>ðŸŽµ Irish Folk Music Generator</strong>
                        </p>
                        <p class="text-muted mb-0">
                            This model was trained on 214,122 Irish folk tunes from the IrishMAN dataset using a 2-layer LSTM neural network. 
                            It learned to generate new music by predicting the next character in ABC notation sequences, achieving 95.4% top-5 accuracy. 
                            Each tune is generated character-by-character, learning musical patterns, note sequences, and proper ABC notation structure. 
                            Adjust the temperature slider to control creativity: lower values produce more traditional tunes, higher values create more experimental music.
                        </p>
                    </div>
                </div>

                <!-- ABC Notation Display Card -->
                <div class="card shadow-lg border-0 mb-4">
                    <div class="card-header bg-gradient text-white">
                        <h5 class="mb-0"><i class="fas fa-code"></i> ABC Notation</h5>
                    </div>
                    <div class="card-body">
                        <pre id="musicDisplay" class="bg-dark text-light p-4 rounded" style="max-height: 200px; overflow-y: auto; font-size: 0.85rem;"><code id="musicCode">ðŸŽ¼ No music generated yet. Click "Generate Music" to start.</code></pre>
                    </div>
                </div>

                <!-- Playback Controls Card -->
                <div class="card shadow-lg border-0 mb-4">
                    <div class="card-header bg-gradient text-white">
                        <h5 class="mb-0"><i class="fas fa-download"></i> Download & Play</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex gap-2 mb-3 flex-wrap">
                            <button type="button" class="btn btn-info btn-lg" id="downloadAbcBtn" disabled>
                                <i class="fas fa-file-code"></i> Download ABC
                            </button>
                            <a href="https://abc.rectanglered.com/" target="_blank" class="btn btn-success btn-lg">
                                <i class="fas fa-play-circle"></i> Play Online
                            </a>
                            <button type="button" class="btn btn-outline-warning btn-lg" id="favoriteBtn" disabled>
                                <i class="far fa-star"></i> Favorite
                            </button>
                        </div>
                        <div id="downloadStatus" class="alert alert-info mb-0">
                            <i class="fas fa-info-circle"></i> Copy ABC notation and paste it on <strong>abc.rectanglered.com</strong> to play online
                        </div>
                    </div>
                </div>

                <!-- History Card -->
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-gradient text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-history"></i> Generation History</h5>
                            <button type="button" class="btn btn-sm btn-outline-light" id="clearHistoryBtn">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="historyList" class="list-group" style="max-height: 300px; overflow-y: auto;">
                            <p class="text-muted text-center py-4"><i class="fas fa-inbox"></i> No generations yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-light text-center py-4 mt-5">
        <p class="mb-0"><i class="fas fa-copyright"></i> 2024 Music Generation Studio. Powered by AI.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/generation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/history.js') }}"></script>
    <script src="{{ url_for('static', filename='js/storage.js') }}"></script>
</body>
</html>
